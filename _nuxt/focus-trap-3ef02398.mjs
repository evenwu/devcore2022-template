import{P as N,u as j}from"./render-a3268961.mjs";import{m as y,p as D}from"./hidden-2d29a848.mjs";import{o as b}from"./dom-d07dd68d.mjs";import{P as w,L as p,H as f,N as k}from"./focus-management-a746db8b.mjs";import{n as B,r as P,d as h}from"./use-event-listener-422bd38e.mjs";import{e as g}from"./owner-ef86f285.mjs";import{i as O,j as F,k as m,m as d,F as S,v as A,y as T}from"./entry-e833c832.mjs";import"./use-window-event-e76f3a5c.mjs";var E=(e=>(e[e.None=1]="None",e[e.InitialFocus=2]="InitialFocus",e[e.TabLock=4]="TabLock",e[e.FocusLock=8]="FocusLock",e[e.RestoreFocus=16]="RestoreFocus",e[e.All=30]="All",e))(E||{});let U=Object.assign(O({name:"FocusTrap",props:{as:{type:[Object,String],default:"div"},initialFocus:{type:Object,default:null},features:{type:Number,default:30},containers:{type:Object,default:F(new Set)}},inheritAttrs:!1,setup(e,{attrs:a,slots:o,expose:l}){let t=F(null);l({el:t,$el:t});let u=m(()=>g(t));x({ownerDocument:u},m(()=>Boolean(e.features&16)));let r=C({ownerDocument:u,container:t,initialFocus:m(()=>e.initialFocus)},m(()=>Boolean(e.features&2)));H({ownerDocument:u,container:t,containers:e.containers,previousActiveElement:r},m(()=>Boolean(e.features&8)));let s=B();function i(){let n=b(t);!n||j(s.value,{[h.Forwards]:()=>w(n,p.First),[h.Backwards]:()=>w(n,p.Last)})}return()=>{let n={},v={ref:t},{features:c,initialFocus:M,containers:R,...L}=e;return d(S,[Boolean(c&4)&&d(y,{as:"button",type:"button",onFocus:i,features:D.Focusable}),N({ourProps:v,theirProps:{...a,...L},slot:n,attrs:a,slots:o,name:"FocusTrap"}),Boolean(c&4)&&d(y,{as:"button",type:"button",onFocus:i,features:D.Focusable})])}}}),{features:E});function x({ownerDocument:e},a){let o=F(null),l={value:!1};A(()=>{T(a,(t,u)=>{var r;t!==u&&(!a.value||(l.value=!0,o.value||(o.value=(r=e.value)==null?void 0:r.activeElement)))},{immediate:!0}),T(a,(t,u,r)=>{t!==u&&(!a.value||r(()=>{l.value!==!1&&(l.value=!1,f(o.value),o.value=null)}))},{immediate:!0})})}function C({ownerDocument:e,container:a,initialFocus:o},l){let t=F(null);return A(()=>{T([a,o,l],(u,r)=>{if(u.every((i,n)=>(r==null?void 0:r[n])===i)||!l.value)return;let s=b(a);!s||requestAnimationFrame(()=>{var i,n;let v=b(o),c=(i=e.value)==null?void 0:i.activeElement;if(v){if(v===c){t.value=c;return}}else if(s.contains(c)){t.value=c;return}v?f(v):w(s,p.First|p.NoScroll)===k.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),t.value=(n=e.value)==null?void 0:n.activeElement})},{immediate:!0,flush:"post"})}),t}function H({ownerDocument:e,container:a,containers:o,previousActiveElement:l},t){var u;P((u=e.value)==null?void 0:u.defaultView,"focus",r=>{if(!t.value)return;let s=new Set(o==null?void 0:o.value);s.add(a);let i=l.value;if(!i)return;let n=r.target;n&&n instanceof HTMLElement?I(s,n)?(l.value=n,f(n)):(r.preventDefault(),r.stopPropagation(),f(i)):f(l.value)},!0)}function I(e,a){var o;for(let l of e)if((o=l.value)!=null&&o.contains(a))return!0;return!1}export{U as FocusTrap};
