import{u as T,A as N,P as I,N as F,R as V}from"./render-0b5e10c9.mjs";import{t as B}from"./use-id-2e145a0f.mjs";import{o as d}from"./keyboard-c50452c7.mjs";import{x as U,a as b}from"./calculate-active-index-130b59fd.mjs";import{o as c}from"./dom-d07dd68d.mjs";import{c as q,l as j,p as H}from"./open-closed-5b41599b.mjs";import{b as K}from"./use-resolve-button-type-eb0c2f14.mjs";import{F as Q,M as W,w as G}from"./focus-management-bdc6f191.mjs";import{T as J}from"./use-outside-click-efce7701.mjs";import{m as X,p as Y}from"./hidden-8943c547.mjs";import{e as Z}from"./form-a0e06e57.mjs";import{i as D,j as R,k as S,m as E,F as _,v as A,x as ee,z as te,l as oe,C as L,y as k,q as le,p as ae}from"./entry-ce8d72d4.mjs";import"./owner-ef86f285.mjs";import"./use-window-event-f69a4993.mjs";var ie=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(ie||{}),ne=(t=>(t[t.Single=0]="Single",t[t.Multi=1]="Multi",t))(ne||{}),re=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(re||{});function ue(t){requestAnimationFrame(()=>requestAnimationFrame(t))}let z=Symbol("ListboxContext");function C(t){let f=le(z,null);if(f===null){let m=new Error(`<${t} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(m,C),m}return f}let ye=D({name:"Listbox",emits:{"update:modelValue":t=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},horizontal:{type:[Boolean],default:!1},modelValue:{type:[Object,String,Number,Boolean]},name:{type:String,optional:!0},multiple:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:f,attrs:m,emit:g}){let e=R(1),v=R(null),s=R(null),x=R(null),u=R([]),O=R(""),o=R(null),i=R(1);function y(l=a=>a){let a=o.value!==null?u.value[o.value]:null,n=G(l(u.value.slice()),h=>c(h.dataRef.domRef)),p=a?n.indexOf(a):null;return p===-1&&(p=null),{options:n,activeOptionIndex:p}}let w=S(()=>t.modelValue),P=S(()=>t.multiple?1:0),r={listboxState:e,value:w,mode:P,compare(l,a){return l===a},orientation:S(()=>t.horizontal?"horizontal":"vertical"),labelRef:v,buttonRef:s,optionsRef:x,disabled:S(()=>t.disabled),options:u,searchQuery:O,activeOptionIndex:o,activationTrigger:i,closeListbox(){t.disabled||e.value!==1&&(e.value=1,o.value=null)},openListbox(){t.disabled||e.value!==0&&(e.value=0)},goToOption(l,a,n){if(t.disabled||e.value===1)return;let p=y(),h=U(l===b.Specific?{focus:b.Specific,id:a}:{focus:l},{resolveItems:()=>p.options,resolveActiveIndex:()=>p.activeOptionIndex,resolveId:$=>$.id,resolveDisabled:$=>$.dataRef.disabled});O.value="",o.value=h,i.value=n!=null?n:1,u.value=p.options},search(l){if(t.disabled||e.value===1)return;let a=O.value!==""?0:1;O.value+=l.toLowerCase();let n=(o.value!==null?u.value.slice(o.value+a).concat(u.value.slice(0,o.value+a)):u.value).find(h=>h.dataRef.textValue.startsWith(O.value)&&!h.dataRef.disabled),p=n?u.value.indexOf(n):-1;p===-1||p===o.value||(o.value=p,i.value=1)},clearSearch(){t.disabled||e.value!==1&&O.value!==""&&(O.value="")},registerOption(l,a){let n=y(p=>[...p,{id:l,dataRef:a}]);u.value=n.options,o.value=n.activeOptionIndex},unregisterOption(l){let a=y(n=>{let p=n.findIndex(h=>h.id===l);return p!==-1&&n.splice(p,1),n});u.value=a.options,o.value=a.activeOptionIndex,i.value=1},select(l){t.disabled||g("update:modelValue",T(P.value,{[0]:()=>l,[1]:()=>{let a=L(r.value.value).slice(),n=L(l),p=a.findIndex(h=>r.compare(n,L(h)));return p===-1?a.push(n):a.splice(p,1),a}}))}};return J([s,x],(l,a)=>{var n;r.closeListbox(),Q(a,W.Loose)||(l.preventDefault(),(n=c(s))==null||n.focus())},S(()=>e.value===0)),ae(z,r),q(S(()=>T(e.value,{[0]:j.Open,[1]:j.Closed}))),()=>{let{name:l,modelValue:a,disabled:n,...p}=t,h={open:e.value===0,disabled:n};return E(_,[...l!=null&&a!=null?Z({[l]:a}).map(([$,M])=>E(X,N({features:Y.Hidden,key:$,as:"input",type:"hidden",hidden:!0,readOnly:!0,name:$,value:M}))):[],I({ourProps:{},theirProps:{...m,...F(p,["onUpdate:modelValue","horizontal","multiple","by"])},slot:h,slots:f,attrs:m,name:"Listbox"})])}}}),Re=D({name:"ListboxLabel",props:{as:{type:[Object,String],default:"label"}},setup(t,{attrs:f,slots:m}){let g=C("ListboxLabel"),e=`headlessui-listbox-label-${B()}`;function v(){var s;(s=c(g.buttonRef))==null||s.focus({preventScroll:!0})}return()=>{let s={open:g.listboxState.value===0,disabled:g.disabled.value},x={id:e,ref:g.labelRef,onClick:v};return I({ourProps:x,theirProps:t,slot:s,attrs:f,slots:m,name:"ListboxLabel"})}}}),we=D({name:"ListboxButton",props:{as:{type:[Object,String],default:"button"}},setup(t,{attrs:f,slots:m,expose:g}){let e=C("ListboxButton"),v=`headlessui-listbox-button-${B()}`;g({el:e.buttonRef,$el:e.buttonRef});function s(o){switch(o.key){case d.Space:case d.Enter:case d.ArrowDown:o.preventDefault(),e.openListbox(),k(()=>{var i;(i=c(e.optionsRef))==null||i.focus({preventScroll:!0}),e.value.value||e.goToOption(b.First)});break;case d.ArrowUp:o.preventDefault(),e.openListbox(),k(()=>{var i;(i=c(e.optionsRef))==null||i.focus({preventScroll:!0}),e.value.value||e.goToOption(b.Last)});break}}function x(o){switch(o.key){case d.Space:o.preventDefault();break}}function u(o){e.disabled.value||(e.listboxState.value===0?(e.closeListbox(),k(()=>{var i;return(i=c(e.buttonRef))==null?void 0:i.focus({preventScroll:!0})})):(o.preventDefault(),e.openListbox(),ue(()=>{var i;return(i=c(e.optionsRef))==null?void 0:i.focus({preventScroll:!0})})))}let O=K(S(()=>({as:t.as,type:f.type})),e.buttonRef);return()=>{var o,i;let y={open:e.listboxState.value===0,disabled:e.disabled.value},w={ref:e.buttonRef,id:v,type:O.value,"aria-haspopup":!0,"aria-controls":(o=c(e.optionsRef))==null?void 0:o.id,"aria-expanded":e.disabled.value?void 0:e.listboxState.value===0,"aria-labelledby":e.labelRef.value?[(i=c(e.labelRef))==null?void 0:i.id,v].join(" "):void 0,disabled:e.disabled.value===!0?!0:void 0,onKeydown:s,onKeyup:x,onClick:u};return I({ourProps:w,theirProps:t,slot:y,attrs:f,slots:m,name:"ListboxButton"})}}}),Pe=D({name:"ListboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(t,{attrs:f,slots:m,expose:g}){let e=C("ListboxOptions"),v=`headlessui-listbox-options-${B()}`,s=R(null);g({el:e.optionsRef,$el:e.optionsRef});function x(o){switch(s.value&&clearTimeout(s.value),o.key){case d.Space:if(e.searchQuery.value!=="")return o.preventDefault(),o.stopPropagation(),e.search(o.key);case d.Enter:if(o.preventDefault(),o.stopPropagation(),e.activeOptionIndex.value!==null){let i=e.options.value[e.activeOptionIndex.value];e.select(i.dataRef.value)}e.mode.value===0&&(e.closeListbox(),k(()=>{var i;return(i=c(e.buttonRef))==null?void 0:i.focus({preventScroll:!0})}));break;case T(e.orientation.value,{vertical:d.ArrowDown,horizontal:d.ArrowRight}):return o.preventDefault(),o.stopPropagation(),e.goToOption(b.Next);case T(e.orientation.value,{vertical:d.ArrowUp,horizontal:d.ArrowLeft}):return o.preventDefault(),o.stopPropagation(),e.goToOption(b.Previous);case d.Home:case d.PageUp:return o.preventDefault(),o.stopPropagation(),e.goToOption(b.First);case d.End:case d.PageDown:return o.preventDefault(),o.stopPropagation(),e.goToOption(b.Last);case d.Escape:o.preventDefault(),o.stopPropagation(),e.closeListbox(),k(()=>{var i;return(i=c(e.buttonRef))==null?void 0:i.focus({preventScroll:!0})});break;case d.Tab:o.preventDefault(),o.stopPropagation();break;default:o.key.length===1&&(e.search(o.key),s.value=setTimeout(()=>e.clearSearch(),350));break}}let u=H(),O=S(()=>u!==null?u.value===j.Open:e.listboxState.value===0);return()=>{var o,i,y,w;let P={open:e.listboxState.value===0},r={"aria-activedescendant":e.activeOptionIndex.value===null||(o=e.options.value[e.activeOptionIndex.value])==null?void 0:o.id,"aria-multiselectable":e.mode.value===1?!0:void 0,"aria-labelledby":(w=(i=c(e.labelRef))==null?void 0:i.id)!=null?w:(y=c(e.buttonRef))==null?void 0:y.id,"aria-orientation":e.orientation.value,id:v,onKeydown:x,role:"listbox",tabIndex:0,ref:e.optionsRef};return I({ourProps:r,theirProps:t,slot:P,attrs:f,slots:m,features:V.RenderStrategy|V.Static,visible:O.value,name:"ListboxOptions"})}}}),Te=D({name:"ListboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1}},setup(t,{slots:f,attrs:m,expose:g}){let e=C("ListboxOption"),v=`headlessui-listbox-option-${B()}`,s=R(null);g({el:s,$el:s});let x=S(()=>e.activeOptionIndex.value!==null?e.options.value[e.activeOptionIndex.value].id===v:!1),u=S(()=>T(e.mode.value,{[0]:()=>e.compare(L(e.value.value),L(t.value)),[1]:()=>L(e.value.value).some(r=>e.compare(L(r),L(t.value)))})),O=S(()=>T(e.mode.value,{[1]:()=>{var r;let l=L(e.value.value);return((r=e.options.value.find(a=>l.some(n=>e.compare(L(n),L(a.dataRef.value)))))==null?void 0:r.id)===v},[0]:()=>u.value})),o=S(()=>({disabled:t.disabled,value:t.value,textValue:"",domRef:s}));A(()=>{var r,l;let a=(l=(r=c(s))==null?void 0:r.textContent)==null?void 0:l.toLowerCase().trim();a!==void 0&&(o.value.textValue=a)}),A(()=>e.registerOption(v,o)),ee(()=>e.unregisterOption(v)),A(()=>{te([e.listboxState,u],()=>{e.listboxState.value===0&&(!u.value||T(e.mode.value,{[1]:()=>{O.value&&e.goToOption(b.Specific,v)},[0]:()=>{e.goToOption(b.Specific,v)}}))},{immediate:!0})}),oe(()=>{e.listboxState.value===0&&(!x.value||e.activationTrigger.value!==0&&k(()=>{var r,l;return(l=(r=c(s))==null?void 0:r.scrollIntoView)==null?void 0:l.call(r,{block:"nearest"})}))});function i(r){if(t.disabled)return r.preventDefault();e.select(t.value),e.mode.value===0&&(e.closeListbox(),k(()=>{var l;return(l=c(e.buttonRef))==null?void 0:l.focus({preventScroll:!0})}))}function y(){if(t.disabled)return e.goToOption(b.Nothing);e.goToOption(b.Specific,v)}function w(){t.disabled||x.value||e.goToOption(b.Specific,v,0)}function P(){t.disabled||!x.value||e.goToOption(b.Nothing)}return()=>{let{disabled:r}=t,l={active:x.value,selected:u.value,disabled:r},a={id:v,ref:s,role:"option",tabIndex:r===!0?void 0:-1,"aria-disabled":r===!0?!0:void 0,"aria-selected":u.value===!0?u.value:void 0,disabled:void 0,onClick:i,onFocus:y,onPointermove:w,onMousemove:w,onPointerleave:P,onMouseleave:P};return I({ourProps:a,theirProps:F(t,["value","disabled"]),slot:l,attrs:m,slots:f,name:"ListboxOption"})}}});export{ye as Listbox,we as ListboxButton,Re as ListboxLabel,Te as ListboxOption,Pe as ListboxOptions};
