import{P as G,R as M,u as j}from"./render-0b5e10c9.mjs";import{t as D}from"./use-id-2e145a0f.mjs";import{o as I}from"./keyboard-c50452c7.mjs";import{F as oe,M as le,P as w,L as B,b as ne}from"./focus-management-bdc6f191.mjs";import{o as l}from"./dom-d07dd68d.mjs";import{c as ae,l as W,p as Z}from"./open-closed-5b41599b.mjs";import{b as re}from"./use-resolve-button-type-eb0c2f14.mjs";import{T as ue}from"./use-outside-click-efce7701.mjs";import{e as A}from"./owner-ef86f285.mjs";import{r as se,n as Q,d as x}from"./use-event-listener-ef05260e.mjs";import{m as N,p as R}from"./hidden-8943c547.mjs";import{i as L,j as k,k as O,l as q,m as C,F as U,p as z,q as J}from"./entry-ce8d72d4.mjs";import"./use-window-event-f69a4993.mjs";var pe=(s=>(s[s.Open=0]="Open",s[s.Closed=1]="Closed",s))(pe||{});let X=Symbol("PopoverContext");function H(s){let b=J(X,null);if(b===null){let y=new Error(`<${s} /> is missing a parent <${ve.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(y,H),y}return b}let Y=Symbol("PopoverGroupContext");function _(){return J(Y,null)}let ee=Symbol("PopoverPanelContext");function ie(){return J(ee,null)}let ve=L({name:"Popover",props:{as:{type:[Object,String],default:"div"}},setup(s,{slots:b,attrs:y,expose:h}){var t;let e=`headlessui-popover-button-${D()}`,g=`headlessui-popover-panel-${D()}`,c=k(null);h({el:c,$el:c});let d=k(1),v=k(null),$=k(null),m=k(null),p=k(null),S=O(()=>A(c)),E=O(()=>{if(!l(v)||!l(p))return!1;for(let n of document.querySelectorAll("body > *"))if(Number(n==null?void 0:n.contains(l(v)))^Number(n==null?void 0:n.contains(l(p))))return!0;return!1}),f={popoverState:d,buttonId:e,panelId:g,panel:p,button:v,isPortalled:E,beforePanelSentinel:$,afterPanelSentinel:m,togglePopover(){d.value=j(d.value,{[0]:1,[1]:0})},closePopover(){d.value!==1&&(d.value=1)},close(n){f.closePopover();let i=(()=>n?n instanceof HTMLElement?n:n.value instanceof HTMLElement?l(n):l(f.button):l(f.button))();i==null||i.focus()}};z(X,f),ae(O(()=>j(d.value,{[0]:W.Open,[1]:W.Closed})));let u={buttonId:e,panelId:g,close(){f.closePopover()}},o=_(),a=o==null?void 0:o.registerPopover;function P(){var n,i,r,F;return(F=o==null?void 0:o.isFocusWithinPopoverGroup())!=null?F:((n=S.value)==null?void 0:n.activeElement)&&(((i=l(v))==null?void 0:i.contains(S.value.activeElement))||((r=l(p))==null?void 0:r.contains(S.value.activeElement)))}return q(()=>a==null?void 0:a(u)),se((t=S.value)==null?void 0:t.defaultView,"focus",n=>{var i,r;d.value===0&&(P()||!v||!p||(i=l(f.beforePanelSentinel))!=null&&i.contains(n.target)||(r=l(f.afterPanelSentinel))!=null&&r.contains(n.target)||f.closePopover())},!0),ue([v,p],(n,i)=>{var r;f.closePopover(),oe(i,le.Loose)||(n.preventDefault(),(r=l(v))==null||r.focus())},O(()=>d.value===0)),()=>{let n={open:d.value===0,close:f.close};return G({theirProps:s,ourProps:{ref:c},slot:n,slots:b,attrs:y,name:"Popover"})}}}),Ee=L({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(s,{attrs:b,slots:y,expose:h}){let t=H("PopoverButton"),e=O(()=>A(t.button));h({el:t.button,$el:t.button});let g=_(),c=g==null?void 0:g.closeOthers,d=ie(),v=d===null?!1:d===t.panelId,$=k(null),m=`headlessui-focus-sentinel-${D()}`;v||q(()=>{t.button.value=$.value});let p=re(O(()=>({as:s.as,type:b.type})),$);function S(o){var a,P,n,i,r;if(v){if(t.popoverState.value===1)return;switch(o.key){case I.Space:case I.Enter:o.preventDefault(),(P=(a=o.target).click)==null||P.call(a),t.closePopover(),(n=l(t.button))==null||n.focus();break}}else switch(o.key){case I.Space:case I.Enter:o.preventDefault(),o.stopPropagation(),t.popoverState.value===1&&(c==null||c(t.buttonId)),t.togglePopover();break;case I.Escape:if(t.popoverState.value!==0)return c==null?void 0:c(t.buttonId);if(!l(t.button)||((i=e.value)==null?void 0:i.activeElement)&&!((r=l(t.button))!=null&&r.contains(e.value.activeElement)))return;o.preventDefault(),o.stopPropagation(),t.closePopover();break}}function E(o){v||o.key===I.Space&&o.preventDefault()}function f(o){var a,P;s.disabled||(v?(t.closePopover(),(a=l(t.button))==null||a.focus()):(o.preventDefault(),o.stopPropagation(),t.popoverState.value===1&&(c==null||c(t.buttonId)),t.togglePopover(),(P=l(t.button))==null||P.focus()))}function u(o){o.preventDefault(),o.stopPropagation()}return()=>{let o=t.popoverState.value===0,a={open:o},P=v?{ref:$,type:p.value,onKeydown:S,onClick:f}:{ref:$,id:t.buttonId,type:p.value,"aria-expanded":s.disabled?void 0:t.popoverState.value===0,"aria-controls":l(t.panel)?t.panelId:void 0,disabled:s.disabled?!0:void 0,onKeydown:S,onKeyup:E,onClick:f,onMousedown:u},n=Q();function i(){let r=l(t.panel);if(!r)return;function F(){j(n.value,{[x.Forwards]:()=>w(r,B.First),[x.Backwards]:()=>w(r,B.Last)})}F()}return C(U,[G({ourProps:P,theirProps:{...b,...s},slot:a,attrs:b,slots:y,name:"PopoverButton"}),o&&!v&&t.isPortalled.value&&C(N,{id:m,features:R.Focusable,as:"button",type:"button",onFocus:i})])}}}),Fe=L({name:"PopoverOverlay",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(s,{attrs:b,slots:y}){let h=H("PopoverOverlay"),t=`headlessui-popover-overlay-${D()}`,e=Z(),g=O(()=>e!==null?e.value===W.Open:h.popoverState.value===0);function c(){h.closePopover()}return()=>{let d={open:h.popoverState.value===0};return G({ourProps:{id:t,"aria-hidden":!0,onClick:c},theirProps:s,slot:d,attrs:b,slots:y,features:M.RenderStrategy|M.Static,visible:g.value,name:"PopoverOverlay"})}}}),Ie=L({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1}},inheritAttrs:!1,setup(s,{attrs:b,slots:y,expose:h}){let{focus:t}=s,e=H("PopoverPanel"),g=O(()=>A(e.panel)),c=`headlessui-focus-sentinel-before-${D()}`,d=`headlessui-focus-sentinel-after-${D()}`;h({el:e.panel,$el:e.panel}),z(ee,e.panelId),q(()=>{var u,o;if(!t||e.popoverState.value!==0||!e.panel)return;let a=(u=g.value)==null?void 0:u.activeElement;(o=l(e.panel))!=null&&o.contains(a)||w(l(e.panel),B.First)});let v=Z(),$=O(()=>v!==null?v.value===W.Open:e.popoverState.value===0);function m(u){var o,a;switch(u.key){case I.Escape:if(e.popoverState.value!==0||!l(e.panel)||g.value&&!((o=l(e.panel))!=null&&o.contains(g.value.activeElement)))return;u.preventDefault(),u.stopPropagation(),e.closePopover(),(a=l(e.button))==null||a.focus();break}}function p(u){var o,a,P,n,i;let r=u.relatedTarget;!r||!l(e.panel)||(o=l(e.panel))!=null&&o.contains(r)||(e.closePopover(),(((P=(a=l(e.beforePanelSentinel))==null?void 0:a.contains)==null?void 0:P.call(a,r))||((i=(n=l(e.afterPanelSentinel))==null?void 0:n.contains)==null?void 0:i.call(n,r)))&&r.focus({preventScroll:!0}))}let S=Q();function E(){let u=l(e.panel);if(!u)return;function o(){j(S.value,{[x.Forwards]:()=>{w(u,B.Next)},[x.Backwards]:()=>{var a;(a=l(e.button))==null||a.focus({preventScroll:!0})}})}o()}function f(){let u=l(e.panel);if(!u)return;function o(){j(S.value,{[x.Forwards]:()=>{var a,P;let n=l(e.button),i=l(e.panel);if(!n)return;let r=ne(),F=r.indexOf(n),te=r.slice(0,F+1),T=[...r.slice(F+1),...te];for(let K of T.slice())if(((P=(a=K==null?void 0:K.id)==null?void 0:a.startsWith)==null?void 0:P.call(a,"headlessui-focus-sentinel-"))||(i==null?void 0:i.contains(K))){let V=T.indexOf(K);V!==-1&&T.splice(V,1)}w(T,B.First,!1)},[x.Backwards]:()=>w(u,B.Previous)})}o()}return()=>{let u={open:e.popoverState.value===0,close:e.close},o={ref:e.panel,id:e.panelId,onKeydown:m,onFocusout:t&&e.popoverState.value===0?p:void 0,tabIndex:-1};return G({ourProps:o,theirProps:{...b,...s},attrs:b,slot:u,slots:{...y,default:(...a)=>{var P;return[C(U,[$.value&&e.isPortalled.value&&C(N,{id:c,ref:e.beforePanelSentinel,features:R.Focusable,as:"button",type:"button",onFocus:E}),(P=y.default)==null?void 0:P.call(y,...a),$.value&&e.isPortalled.value&&C(N,{id:d,ref:e.afterPanelSentinel,features:R.Focusable,as:"button",type:"button",onFocus:f})])]}},features:M.RenderStrategy|M.Static,visible:$.value,name:"PopoverPanel"})}}}),we=L({name:"PopoverGroup",props:{as:{type:[Object,String],default:"div"}},setup(s,{attrs:b,slots:y,expose:h}){let t=k(null),e=k([]),g=O(()=>A(t));h({el:t,$el:t});function c(m){let p=e.value.indexOf(m);p!==-1&&e.value.splice(p,1)}function d(m){return e.value.push(m),()=>{c(m)}}function v(){var m;let p=g.value;if(!p)return!1;let S=p.activeElement;return(m=l(t))!=null&&m.contains(S)?!0:e.value.some(E=>{var f,u;return((f=p.getElementById(E.buttonId))==null?void 0:f.contains(S))||((u=p.getElementById(E.panelId))==null?void 0:u.contains(S))})}function $(m){for(let p of e.value)p.buttonId!==m&&p.close()}return z(Y,{registerPopover:d,unregisterPopover:c,isFocusWithinPopoverGroup:v,closeOthers:$}),()=>G({ourProps:{ref:t},theirProps:s,slot:{},attrs:b,slots:y,name:"PopoverGroup"})}});export{ve as Popover,Ee as PopoverButton,we as PopoverGroup,Fe as PopoverOverlay,Ie as PopoverPanel};
